<!DOCTYPE html><html lang="ru"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Full Body • 4 недели</title>
<style>
:root{--bg:#0b0b0e;--panel:#15161a;--panel2:#121317;--soft:#0e0f12;--border:#2b2f36;--text:#ffd700;--muted:#b9aa68;--white:#f4f4f4;--r:18px}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--white);font-family:Inter,Segoe UI,Roboto,Arial,sans-serif}
header{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,#0b0b0e,rgba(11,11,14,.92));border-bottom:1px solid var(--border);padding:12px 16px 6px}
.h1{margin:0;font-size:20px;font-weight:800}.sub{margin-top:6px;color:var(--muted);font-size:12px}
.controls{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
select,.tab{background:var(--panel2);color:var(--white);border:1px solid var(--border);border-radius:12px;padding:8px 12px;font-weight:800}
.tab.active{background:var(--text);color:#000;border-color:var(--text)}
main{padding:14px;display:grid;gap:14px}
.card{background:var(--panel);border:1px solid var(--border);border-radius:var(--r);overflow:hidden;box-shadow:0 10px 26px rgba(0,0,0,.25)}
.head{display:flex;align-items:center;justify-content:space-between;padding:14px 14px 8px}
.left{display:flex;gap:10px;align-items:center}
.thumb{width:44px;height:44px;border-radius:12px;background:var(--soft);border:1px solid var(--border);display:grid;place-items:center}
.title{font-weight:800;font-size:16px}.meta{font-size:12px;color:var(--muted)}.hint{font-size:12px;color:#aeb3bb;margin-top:4px}
.video{background:#000}.video iframe{width:100%;aspect-ratio:16/9;border:0;display:block}
.body{padding:14px;display:grid;gap:12px}.history{font-weight:700;color:#9aa0a6;font-size:13px}.date{font-size:14px;margin-top:8px;margin-bottom:6px;color:#d0d0d0}
.sets{display:grid;gap:10px}
.row{display:grid;grid-template-columns:34px 120px 120px 72px 42px;gap:10px;align-items:center}
@media (max-width:380px){.row{grid-template-columns:30px 105px 105px 66px 36px}}
.badge{height:40px;border-radius:12px;border:1px solid var(--border);background:var(--soft);display:grid;place-items:center;color:var(--text);font-weight:800}
.input{display:flex;gap:6px;align-items:center;background:#101215;border:1px solid var(--border);border-radius:12px;padding:6px}
.input input,.input select{width:100%;background:#1c1c20;border:1px solid #444;border-radius:8px;outline:none;color:#ffd700;font-size:18px;font-weight:700;text-align:center;padding:6px 8px}
.input input::placeholder{color:#b9aa68;opacity:.9}
.input input:focus,.input select:focus{border-color:var(--text);box-shadow:0 0 0 2px rgba(255,215,0,.15)}
.input.rir select{font-size:16px;padding:4px 6px}
.check{width:24px;height:24px;border-radius:8px;border:1px solid var(--border);display:grid;place-items:center;cursor:pointer}
.check input{appearance:none;width:18px;height:18px;border-radius:5px;background:#14161a;border:1px solid #2f3340}
.check input:checked{background:var(--text);border-color:var(--text)}
.actions{display:flex;gap:8px;flex-wrap:wrap}
.btn{border:1px solid var(--border);background:var(--panel2);color:#fff;border-radius:12px;padding:10px 14px;font-weight:800}
.btn.gold{background:var(--text);border-color:var(--text);color:#000}
.bar{position:sticky;bottom:0;z-index:15;background:linear-gradient(0deg,#0b0b0e,rgba(11,11,14,.92));border-top:1px solid var(--border);padding:12px 14px;display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
.note{font-size:12px;color:var(--muted);text-align:center;margin:4px 0 12px}
.sum{font-weight:800;color:#ffd700}.weeksum{font-weight:700;color:#c8b767;font-size:13px}
.tech{background:#0f1014;border-top:1px dashed var(--border);padding:10px 14px;display:none}
.tech p{margin:6px 0 0 0;color:#cfcfcf;font-size:13px;line-height:1.35}.tech b{color:#ffd700}
.techBtn{border:1px dashed var(--border);background:#0f1014;color:#ffd700;border-radius:10px;padding:6px 10px;font-weight:800;font-size:12px}
.techWrap{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
</style>
</head>
<body>
<header>
  <div class="h1">Full Body — верх в приоритете</div>
  <div class="sub">Персональный план • 4-недельная периодизация • без осевых нагрузок</div>
  <div class="controls">
    <!-- табы дней создадим из JS в зависимости от user_id -->
    <select id="weekSelect" title="Выбери неделю">
      <option value="1">Неделя 1 — втягивающая</option>
      <option value="2">Неделя 2 — нагрузочная</option>
      <option value="3">Неделя 3 — пиковая</option>
      <option value="4">Неделя 4 — разгрузка</option>
    </select>
  </div>
</header>
<main id="root"></main>
<div class="note">Недели: RIR 1–2 → 0–1 → 0 (пик) → 2–3 (делоад). Нед.2: +5%/+1; Нед.3: +10%/+1–2; Нед.4: −10–20% и −1 подход.</div>
<div class="bar">
  <div>
    <div class="sum" id="summary">Тоннаж: 0 кг • Сеты (вып.): 0</div>
    <div class="weeksum" id="weekSummary">Итого за неделю: 0 кг • сохранённых сетов: 0</div>
  </div>
  <div>
    <button class="btn" id="clearBtn">Очистить день</button>
    <button class="btn gold" id="saveBtn">Сохранить и отправить</button>
  </div>
</div>

<script>
/* ===== Онлайн/офлайн для видео ===== */
const IS_ONLINE = typeof navigator !== 'undefined' ? navigator.onLine : false;
function rutubeFrame(id){
  if(!id) return "";
  if(!IS_ONLINE) return '<div class="video" style="display:flex;align-items:center;justify-content:center;aspect-ratio:16/9;border-top:1px solid #222;border-bottom:1px solid #222"><div style="color:#ffd700;font-weight:800">Видео доступно при интернете</div></div>';
  return `<div class="video"><iframe src="https://rutube.ru/play/embed/${id}" allowfullscreen></iframe></div>`;
}

/* ===== Telegram user ===== */
const TG = window.Telegram?.WebApp || null;
const TG_USER = TG?.initDataUnsafe?.user || null;
const UID = TG_USER?.id || null;
if (TG) TG.expand();

/* ===== ТЕХНИКА ===== */
const TECH = {
  "Жим штанги лёжа":[ "Лопатки сведены, грудь вверх.", "Хват чуть шире плеч; контроль без отскока.", "Траектория — дуга к нижнему краю груди." ],
  "Тяга блока к поясу":[ "Спина ровная, лёгкий наклон.", "Тянем локтями к тазу; пауза в пик-сокращении." ],
  "Жим ногами":[ "Поясница прижата; глубина 90–110°; колени не в замок." ],
  "Подъём штанги на бицепс":[ "Локти у корпуса; без раскачки; темп 2–0–1." ],
  "Жим в тренажёре для плеч":[ "Спина и таз прижаты; амплитуда комфортная." ],
  "Разгибание трицепса в блоке (канат)":[ "Локти фиксированы; внизу разведи канаты и пауза." ],
  "Жим штанги лёжа на наклонной 45°":[ "Лопатки сведены; жми по диагонали вверх; не запирай локти." ],
  "Тяга блока обратным хватом":[ "Локти вдоль корпуса; своди лопатки в конце." ],
  "Разгибание ног в тренажёре":[ "Ось колена совпадает; пауза вверху; вниз — подконтрольно." ],
  "Сгибания рук в кроссовере (бицепс)":[ "Плечи неподвижны; только локоть; без раскачки." ],
  "Разведения гантелей в стороны":[ "Мягкий сгиб локтя; не выше уровня плеч; контроль." ],
  "Отжимания на брусьях":[ "Корпус вперёд (грудь) или вертикаль (трицепс); глубина без боли." ],
  "Отжимания с ногами на возвышении":[ "Корпус одной линией; касание грудью; без провиса поясницы." ],
  "Жим гантелей лёжа":[ "Локти ~45°; пауза внизу; без отскока." ],
  "Тяга гантелей в наклоне":[ "Наклон из таза; тянем локтями; пауза вверху." ],
  "Узкие отжимания":[ "Локти близко к корпусу; корпус — прямая линия." ],
  "Разведения в наклоне":[ "Грудь к бедрам; свод лопаток; без рывков." ],
  "Планка":[ "Таз нейтрален; пресс напряжён; дыхание ровное." ],
  "Приседания с гантелями":[ "Грудь вверх; колени в носки; стопы ровно." ],
  "Выпады назад":[ "Шаг назад; колено под тазом; корпус вертикален." ],
  "Ягодичный мостик":[ "Подбородок к груди; пауза наверху; нейтральная поясница." ],
  "Махи ногами с резинкой":[ "Корпус стабилен; работа из тазобедренного." ],
  "Goblet squat":[ "Гантель у груди; колени в носки; пятка прижата." ],
  "Румынская тяга":[ "Движение из бедра; спина ровная; штанга близко к ногам." ],
  "Жим гантелей вверх":[ "Лопатки стабильно; не запирай локти." ],
  "Велосипед (пресс)":[ "Поясница прижата; крути подконтрольно." ],
  "Интервальный бег":[ "Разминка 5–10 мин; интервалы 30/90 сек; отдышаться между." ],
  "Альпинист":[ "Корпус стабилен; колено к груди; темп контролируй." ],
  "Обратные отжимания от скамьи":[ "Локти назад; плечо не зажимай; амплитуда комфортна." ],
  "Выпрыгивания из приседа":[ "Мягкая посадка; колени в оси; корпус собран." ]
};

/* ===== ПЛАНЫ ===== */
// Твой 3-дневный (зал-зал-дом, с RuTube ID)
const PLAN_OWNER = {
  tabs:["День 1","День 2","День 3"],
  plan:{
    1:[
      {t:"Жим штанги лёжа", base:"4×8–10", sets:4, id:"29048ced12e2808a6097447cf00821fd"},
      {t:"Тяга блока к поясу", base:"4×8–10", sets:4, id:"e5f800727b6688c3ec31f62e48303cb0"},
      {t:"Жим ногами", base:"4×8–10", sets:4, id:"6eb13cced1079f3c1c167ec187c0b324"},
      {t:"Подъём штанги на бицепс", base:"3×12–16", sets:3, id:"9e19a98a96bf0fa3ed85b3d0b3e02a9d"},
      {t:"Жим в тренажёре для плеч", base:"3×12–16", sets:3, id:"dd55b827ba26093c43756fc93e0a0468"},
      {t:"Разгибание трицепса в блоке (канат)", base:"3×12–16", sets:3, id:"c3b414b47e814f390ffda4cd02019b4d"}
    ],
    2:[
      {t:"Жим штанги лёжа на наклонной 45°", base:"4×8–10", sets:4, id:"e585b41ea1a271381fb635e813257048"},
      {t:"Тяга блока обратным хватом", base:"4×8–10", sets:4, id:"b705869d4680dfa63bfff8831610d191"},
      {t:"Разгибание ног в тренажёре", base:"4×8–10", sets:4, id:"f9add4e54a65649c36dc96b40e31091e"},
      {t:"Сгибания рук в кроссовере (бицепс)", base:"3×12–16", sets:3, id:"87549fc5f5de396c2b769f8990778ede"},
      {t:"Разведения гантелей в стороны", base:"3×12–16", sets:3, id:"6128640e54d2e669a0279310980d65cc"},
      {t:"Отжимания на брусьях", base:"3×12–16", sets:3, id:"b8fac352889a4bd4c083d87dd4a1be10"}
    ],
    3:[
      {t:"Отжимания с ногами на возвышении", base:"4×макс", sets:4, id:"8c3c63d02b943d3851527d03c5f0d70d"},
      {t:"Жим гантелей лёжа", base:"3×8–12", sets:3, id:"8727ed482623ae3a9fce393d5456de68"},
      {t:"Тяга гантелей в наклоне", base:"3×8–12", sets:3, id:"1816f401fa38ac77e8c912125728af74"},
      {t:"Узкие отжимания", base:"3×макс", sets:3, id:"b968f2c89084c3d90b9add1da01cf39d"},
      {t:"Подъём гантелей на бицепс", base:"3×12", sets:3, id:"2b0ae567aa5d0a00633594f26fe8bf2e"},
      {t:"Разведения в наклоне", base:"3×12–15", sets:3, id:"5bf13c73ef01f3a4629f00982b83788d"},
      {t:"Планка", base:"3×40–60 сек", sets:3, id:"6df677885d3361d1271228208387c6bd"}
    ]
  }
};

// Mashka (ID 603111062) — 4-дневный домашний план
const PLAN_MASHKA = {
  tabs:["Пн — A","Ср — B","Пт — C","Вс — D"],
  plan:{
    1:[
      {t:"Приседания с гантелями", base:"4×12–15", sets:4},
      {t:"Выпады назад", base:"3×12/нога", sets:3},
      {t:"Ягодичный мостик", base:"4×15–20", sets:4},
      {t:"Махи ногами с резинкой", base:"3×15–20", sets:3},
      {t:"Планка", base:"3×30–60 сек", sets:3},
      {t:"Скручивания", base:"3×15–20", sets:3}
    ],
    2:[
      {t:"Жим гантелей лёжа", base:"4×12–15", sets:4},
      {t:"Тяга гантелей в наклоне", base:"4×12", sets:4},
      {t:"Отжимания", base:"3×макс", sets:3},
      {t:"Разведения гантелей в стороны", base:"3×12–15", sets:3},
      {t:"Сгибания рук (бицепс)", base:"3×12–15", sets:3},
      {t:"Кардио-блок (прыжки)", base:"3×30 сек", sets:3}
    ],
    3:[
      {t:"Goblet squat", base:"4×12–15", sets:4},
      {t:"Румынская тяга", base:"4×12–15", sets:4},
      {t:"Ягодичный мостик с паузой", base:"4×15–20", sets:4},
      {t:"Жим гантелей вверх", base:"3×12–15", sets:3},
      {t:"Обратные разведения в наклоне", base:"3×12–15", sets:3},
      {t:"Велосипед (пресс)", base:"3×20/сторону", sets:3}
    ],
    4:[
      {t:"Интервальный бег", base:"30/90 сек ×6–8", sets:6},
      {t:"Приседания", base:"3×20", sets:3},
      {t:"Отжимания от скамьи/земли", base:"3×макс", sets:3},
      {t:"Выпрыгивания из приседа", base:"3×10–12", sets:3},
      {t:"Альпинист", base:"3×20–30 сек", sets:3},
      {t:"Обратные отжимания от скамьи", base:"3×12–15", sets:3},
      {t:"Пресс (ножницы/подъём ног)", base:"3×15–20", sets:3}
    ]
  }
};

// Выбор плана по user_id
const PLAN = (UID === 603111062) ? PLAN_MASHKA : PLAN_OWNER;

// Периодизация
const WEEKS = {
  1:{ add:0,  note:"RIR 1–2" },
  2:{ add:0,  note:"+5% и/или +1, RIR 0–1" },
  3:{ add:0,  note:"+10% и/или +1–2, RIR 0" },
  4:{ add:-1, note:"Делоад −10–20%, −1 подход, RIR 2–3" }
};

/* ===== UI / ЛОГИКА ===== */
const headerControls = document.querySelector('.controls');
const weekSelect = document.getElementById('weekSelect');
const root = document.getElementById('root');
const summary = document.getElementById('summary');
const weekSummary = document.getElementById('weekSummary');

let day = 1;

// Создаём табы «Дни» по выбранному плане
function buildTabs(){
  // удалить старые
  headerControls.querySelectorAll('button.tab').forEach(b=>b.remove());
  PLAN.tabs.forEach((label,i)=>{
    const b = document.createElement('button');
    b.className = 'tab' + (i===0?' active':'');
    b.dataset.day = String(i+1);
    b.textContent = label;
    b.onclick = ()=>{ document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active')); b.classList.add('active'); day=i+1; render(); };
    headerControls.insertBefore(b, weekSelect);
  });
}
buildTabs();

function today(){
  const d=new Date(),w=["Вск","Пн","Вт","Ср","Чт","Пт","Сб"][d.getDay()],m=["янв","фев","мар","апр","май","июн","июл","авг","сен","окт","ноя","дек"][d.getMonth()];
  return `${d.getDate()} ${m}, ${w}`;
}
function keyName(ex){ return `fb_${day}_${weekSelect.value}_${ex.replace(/\s+/g,'_')}_${UID||'anon'}`; }
function parseNum(v){ const n=parseFloat((v||"").toString().replace(",", ".")); return isNaN(n)?0:n; }

function setRow(i,w='',r='',rir='',done=0){
  const el=document.createElement('div'); el.className='row'; el.innerHTML=`
    <div class="badge">${i}</div>
    <div class="input"><input type="number" step="0.5" inputmode="decimal" placeholder="КГ" value="${w}"></div>
    <div class="input"><input type="number" step="1" inputmode="numeric" placeholder="раз" value="${r}"></div>
    <div class="input rir"><select aria-label="RIR">
      <option value="" ${rir===''?'selected':''}>RIR</option>
      <option value="0" ${rir==='0'?'selected':''}>0</option>
      <option value="1" ${rir==='1'?'selected':''}>1</option>
      <option value="2" ${rir==='2'?'selected':''}>2</option>
      <option value="3" ${rir==='3'?'selected':''}>3</option>
    </select></div>
    <label class="check" title="сет выполнен"><input type="checkbox" ${done? 'checked':''}></label>`;
  el.querySelectorAll('input,select').forEach(i=>i.addEventListener('input',updateSummary));
  return el;
}

function techBlock(name){
  const wrap=document.createElement('div'); wrap.className='techWrap';
  const btn=document.createElement('button'); btn.className='techBtn'; btn.type='button'; btn.textContent='Техника';
  const box=document.createElement('div'); box.className='tech';
  const tips=(TECH[name]||["Нет описания техники."]).map(t=>`<p>• ${t}</p>`).join("");
  box.innerHTML=`<p><b>Как делать:</b></p>${tips}`;
  btn.onclick=()=>{ box.style.display = (box.style.display==='block'?'none':'block'); };
  wrap.appendChild(btn); wrap.appendChild(box);
  return wrap;
}

function card(ex){
  const saved = JSON.parse(localStorage.getItem(keyName(ex.t))||'[]');
  const add = WEEKS[weekSelect.value].add||0;
  const baseSets = Math.max(1, (ex.sets||3) + add);
  const last = JSON.parse(localStorage.getItem(keyName(ex.t)+'_last')||'[]');

  const wrap=document.createElement('section'); wrap.className='card'; wrap.dataset.exercise=ex.t;
  wrap.innerHTML=`
    <div class="head">
      <div class="left">
        <div class="thumb">🏋️</div>
        <div>
          <div class="title">${ex.t}</div>
          <div class="meta">${ex.base||''} ${WEEKS[weekSelect.value].note? '• '+WEEKS[weekSelect.value].note:''}</div>
          <div class="hint">${ last.length ? 'Прошлый раз: ' + last.map(s=>`${s.weight||0}×${s.reps||0}${s.rir!==''?` (RIR ${s.rir})`:''}`).join(', ') : 'Заполни и нажми «Сохранить и отправить»'}</div>
        </div>
      </div>
      <div class="avatar">👤</div>
    </div>
    ${rutubeFrame(ex.id)}
    <div class="body">
      <div class="history">История выполнений:</div>
      <div class="date">${today()}</div>
      <div class="sets"></div>
      <div class="actions">
        <button class="btn add" type="button">+ Подход</button>
        <button class="btn del" type="button">− Удалить</button>
      </div>
    </div>`;
  wrap.querySelector('.body').insertBefore(techBlock(ex.t), wrap.querySelector('.actions'));
  const box=wrap.querySelector('.sets');
  const count = saved.length? saved.length : baseSets;
  for(let i=1;i<=count;i++){
    const s=saved[i-1]||{};
    box.appendChild(setRow(i,s.weight||'',s.reps||'', (s.rir??'').toString(), s.done?1:0));
  }
  wrap.querySelector('.add').onclick=()=>{ box.appendChild(setRow(box.children.length+1)); updateSummary(); };
  wrap.querySelector('.del').onclick=()=>{ if(box.children.length>1){ box.lastElementChild.remove(); updateSummary(); } };
  return wrap;
}

function render(){
  root.innerHTML='';
  (PLAN.plan[day]||[]).forEach(ex=> root.appendChild(card(ex)));
  updateSummary();
}

function updateSummary(){
  let tonnage=0, setsDone=0;
  root.querySelectorAll('.card').forEach(card=>{
    card.querySelectorAll('.row').forEach(r=>{
      const [w,rp]=r.querySelectorAll('input');
      const weight=parseNum(w.value), reps=parseInt(rp.value||0,10);
      const done = r.querySelector('input[type="checkbox"]').checked;
      if(weight>0 && reps>0){
        tonnage += weight*reps;
        if(done) setsDone++;
      }
    });
  });
  summary.textContent = `Тоннаж: ${Math.round(tonnage)} кг • Сеты (вып.): ${setsDone}`;

  let weekTonn=0, weekSets=0;
  Object.keys(localStorage).forEach(k=>{
    const m=k.match(/^fb_(\d+)_(\d+)_(.+)_(\d+|anon)$/);
    if(!m) return;
    const wk = m[2], uid = m[4];
    if(wk !== weekSelect.value) return;
    if((UID||'anon').toString() !== uid) return;
    const arr = JSON.parse(localStorage.getItem(k)||'[]');
    arr.forEach(s=>{
      const w=parseNum(s.weight), r=parseInt(s.reps||0,10);
      if(w>0 && r>0){ weekTonn += w*r; if(s.done) weekSets++; }
    });
  });
  weekSummary.textContent = `Итого за неделю: ${Math.round(weekTonn)} кг • сохранённых сетов: ${weekSets}`;
}

/* кнопки */
document.getElementById('clearBtn').onclick=()=>{ if(confirm('Очистить все поля текущего дня?')) render(); };
document.getElementById('saveBtn').onclick=()=>{
  const payload=[];
  root.querySelectorAll('.card').forEach(card=>{
    const name=card.dataset.exercise, list=[];
    card.querySelectorAll('.row').forEach((r,i)=>{
      const inputs=r.querySelectorAll('input');
      const w=inputs[0], rp=inputs[1], cb=inputs[2];
      const sel=r.querySelector('select');
      const weight=(w.value||'').trim(), reps=(rp.value||'').trim(), rir=(sel.value??'').toString(), done=cb.checked?1:0;
      if(weight || reps){
        const item={set:i+1, weight, reps, rir, done};
        list.push(item);
        payload.push({user_id:UID||null, day, week:+weekSelect.value, exercise:name, ...item, ts:new Date().toISOString()});
      }
    });
    localStorage.setItem(keyName(name), JSON.stringify(list));
    if(list.length) localStorage.setItem(keyName(name)+'_last', JSON.stringify(list));
  });

  if(TG){ TG.sendData(JSON.stringify(payload)); TG.close(); }
  else { alert('Сохранено локально:\n'+JSON.stringify(payload,null,2)); }
};

document.querySelectorAll('.tab').forEach(b=>b.onclick=()=>{document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));b.classList.add('active');day=+b.dataset.day;render();});
weekSelect.onchange = render;

/* старт */
render();
</script>
</body></html>